<!-- Loading State -->
@if (loading()) {
  <div class="loading-container">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    <p>Loading book details...</p>
  </div>
}

<!-- Book Details -->
@if (!loading() && book()) {
  <div class="book-details-container">
    <!-- Back Button -->
    <div class="back-button-container">
      <button mat-button (click)="backToCatalog()">
        <mat-icon>arrow_back</mat-icon>
        Back to Catalog
      </button>
    </div>

    <!-- Book Card -->
    <mat-card class="book-details-card">
      <mat-card-header>
        <mat-icon mat-card-avatar class="book-icon">menu_book</mat-icon>
        <mat-card-title>{{ book()!.title }}</mat-card-title>
        <mat-card-subtitle>{{ book()!.author }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <!-- Genre -->
        <div class="genre-container">
          <mat-chip class="genre-chip">{{ book()!.genre }}</mat-chip>
        </div>

        <!-- Publication Date -->
        <div class="publication-date">
          <mat-icon>calendar_today</mat-icon>
          <span>{{ book()!.publicationDate | date:'MMMM d, yyyy' }}</span>
        </div>


        <!-- Availability -->
        <div class="availability">
          <mat-icon
            [class.available]="book()!.availableCopies > 0"
            [class.unavailable]="book()!.availableCopies === 0"
          >
            {{ book()!.availableCopies > 0 ? 'check_circle' : 'cancel' }}
          </mat-icon>
          <span>{{ getAvailabilityText() }}</span>
        </div>

        <!-- Description -->
        <div class="description">
          <h3>Description</h3>
          <p>{{ book()!.description }}</p>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <!-- Borrow Button -->
        @if (isBookAvailable()) {
          <button
            mat-raised-button
            color="primary"
            (click)="borrowBook()"
            [disabled]="actionInProgress()"
          >
            @if (actionInProgress()) {
              <mat-spinner diameter="20"></mat-spinner>
            } @else {
              <mat-icon>bookmark_add</mat-icon>
            }
            Borrow Book
          </button>
        } @else {
          <button
            mat-raised-button
            color="primary"
            disabled
            matTooltip="No copies available"
          >
            <mat-icon>bookmark_add</mat-icon>
            Borrow Book
          </button>
        }
      </mat-card-actions>
    </mat-card>
  </div>
}

<!-- Empty State -->
@if (!loading() && !book()) {
  <div class="empty-state">
    <mat-icon class="empty-icon">library_books</mat-icon>
    <h2>Book not found</h2>
    <p>The book you're looking for doesn't exist.</p>
    <button mat-raised-button color="primary" (click)="backToCatalog()">
      Back to Catalog
    </button>
  </div>
}
