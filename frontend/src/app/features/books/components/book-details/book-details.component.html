<!-- Loading State -->
@if (loading()) {
  <div class="loading-container">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    <p>Loading book details...</p>
  </div>
}

<!-- Book Details -->
@if (!loading() && book()) {
  <div class="book-details-container">
    <!-- Back Button -->
    <div class="back-button-container">
      <button mat-button (click)="backToCatalog()">
        <img src="/assets/icons/back.png" alt="arrow-back" class="icon">
        Back to Catalog
      </button>
    </div>

    <!-- Book Card -->
    <mat-card class="book-details-card">
      <div class="book-details-content">
        <!-- ðŸ–¼ï¸ Left: Book Image -->
        <div class="book-image-container">
          <img
            class="book-image"
            [src]="'assets/images/book-placeholder.png'"
            alt="{{ book()!.title }} cover"
          />
        </div>

        <!-- ðŸ“˜ Right: Book Info -->
        <div class="book-info-container">
          <mat-card-header>
            <mat-card-title>{{ book()!.title }}</mat-card-title>
            <mat-card-subtitle>{{ book()!.author }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <!-- Genre -->
            <div class="genre-container">
              <mat-chip class="genre-chip">{{ book()!.genre }}</mat-chip>
            </div>

            <!-- Publication Date -->
            <div class="publication-date">
              <img src="/assets/icons/calendar.png" alt="calendar-icon" class="calendar-icon">
              <span>{{ book()!.publicationDate | date:'MMMM d, yyyy' }}</span>
            </div>

            <!-- Availability -->
            <div class="availability">
              <img
              [src]="book()!.availableCopies  > 0 ? '/assets/icons/available.png' : '/assets/icons/unavailable.png'"
              [alt]="book()!.availableCopies  > 0 ? 'Available' : 'Unavailable'"
              class="availability-icon"
            />
            {{ getAvailabilityText()}}
            </div>

            <!-- Description -->
            <div class="description">
              <h3>Description</h3>
              <p>{{ book()!.description }}</p>
            </div>
          </mat-card-content>

          <mat-card-actions>
            @if (checkingStatus()) {
              <mat-spinner diameter="24"></mat-spinner>
            } @else {
              @if (showReturnButton) {
                <!-- ðŸ†• Return button -->
                <button 
                  mat-raised-button 
                  color="accent"
                  class="return-button"
                  [disabled]="actionInProgress()"
                  (click)="returnBook()">
                  @if (actionInProgress()) {
                    <mat-spinner diameter="20"></mat-spinner>
                  } @else {
                    <img src="/assets/icons/return.png" alt="return-icon" class="return-icon">
                    Return Book
                  }
                </button>

                <!-- ðŸ†• Link to view in "My Books" -->
                <button 
                  mat-stroked-button
                  class="view-my-books-button"
                  (click)="viewInMyBooks()">
                  View in My Books
                </button>
              } @else {
                <!-- Borrow button -->
                <button 
                  mat-raised-button 
                  color="primary"
                  class="borrow-button"
                  [disabled]="!canBorrow || actionInProgress()"
                  (click)="borrowBook()">
                  @if (actionInProgress()) {
                    <mat-spinner diameter="20"></mat-spinner>
                  } @else {
                    <img src="/assets/icons/borrow.png" alt="borrow-icon" class="borrow-icon">
                    Borrow Book
                  }
                </button>

                @if (!canBorrow && book()!.availableCopies === 0) {
                  <p class="unavailable-message">
                    No copies currently available
                  </p>
                }
              }
            }
          </mat-card-actions>
        </div>
      </div>
    </mat-card>
  </div>
}

<!-- Empty State -->
@if (!loading() && !book()) {
  <div class="empty-state">
    <mat-icon class="empty-icon">library_books</mat-icon>
    <h2>Book not found</h2>
    <p>The book you're looking for doesn't exist.</p>
    <button mat-raised-button color="primary" (click)="backToCatalog()">
      Back to Catalog
    </button>
  </div>
}
