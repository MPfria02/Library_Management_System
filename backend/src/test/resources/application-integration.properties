# ==================================================
# Integration Test Configuration (with Testcontainers)
# ==================================================

# ----------------------------------
# Server
# ----------------------------------
# Random port ensures no collision with local dev server
server.port=0

# ----------------------------------
# Datasource (overridden by Testcontainers at runtime)
# ----------------------------------
spring.datasource.url=jdbc:postgresql://localhost:5432/test_library_manager
spring.datasource.username=test
spring.datasource.password=test
spring.datasource.driver-class-name=org.postgresql.Driver

# ----------------------------------
# JPA / Hibernate
# ----------------------------------
# Validate schema instead of generating it
# â†’ This enforces that Flyway migrations are correct & up-to-date
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ----------------------------------
# Flyway
# ----------------------------------
# Enable migrations in tests (real-world readiness)
spring.flyway.enabled=true
spring.flyway.clean-disabled=false

# ----------------------------------
# JWT (mirrors main config for end-to-end auth testing)
# ----------------------------------
app.jwt.secret=mySecretKey12345678901234567890123456789012345678901234567890
app.jwt.expiration=86400000

# ----------------------------------
# Logging
# ----------------------------------
logging.level.com.librarymanager=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.testcontainers=INFO
logging.level.org.flywaydb=DEBUG


# ----------------------------------
# Spring Boot Test behavior
# ----------------------------------
# Prevent Spring from replacing Testcontainers DB with H2
spring.test.database.replace=none

# Ensure schema migration runs before JPA initialization
spring.jpa.defer-datasource-initialization=false

# Disable management endpoints
management.endpoints.enabled-by-default=false
